# AttentionAI - Productivity Tracking & Analysis

AttentionAI is an Android application that helps users understand and improve their digital habits through intelligent screen recording, activity tracking, and AI-powered analysis using Google's Gemini API.

## Features

### 🎥 Screen Recording
- **Background screen recording** with system audio capture
- **Foreground service** ensures continuous recording even when app is minimized
- **Optimized video encoding** with HEVC/H.264 compression
- **Automatic file management** with organized storage in device Movies directory

### 🤖 AI-Powered Analysis
- **Gemini 2.5 Flash integration** for video content analysis
- **Multi-file analysis** capability for comprehensive session insights
- **Natural language querying** - ask questions about your productivity sessions
- **Automatic summary generation** with key metrics and recommendations
- **Productivity scoring** and personalized insights

### 📊 Activity Tracking
- **Session-based tracking** with start/stop functionality
- **App usage monitoring** and interaction logging
- **Real-time event capture** including app switches and user interactions
- **Historical data storage** with Room database persistence

### 💬 Intelligent Chat Interface
- **Ask questions** about your recorded sessions
- **Get productivity insights** and recommendations
- **Analyze patterns** across multiple recording sessions
- **Export summaries** and key findings

## Technical Architecture

### Core Components

#### Services
- **`ScreenRecordingService`** - Handles screen recording with MediaProjection API

#### Data Layer
- **Room Database** - Local persistence for sessions, events, and insights
- **Repository Pattern** - Clean separation of data access logic
- **Type Converters** - JSON serialization for complex data types

#### AI Integration
- **`GeminiService`** - High-level AI operations wrapper
- **`GeminiRestService`** - Direct REST API communication with Gemini
- **File Upload Management** - Resumable upload handling for large video files

#### UI
- **Jetpack Compose** - Modern declarative UI framework
- **MVVM Architecture** - Clean separation of concerns
- **State Management** - Reactive UI updates with StateFlow

## Setup & Configuration

### Prerequisites
- Android SDK 26+ (API Level 26)
- Google Gemini API Key
- Device with Android 7.0+ for optimal performance

### Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/yourusername/attentionai.git
   cd attentionai
   ```

2. **Configure Gemini API**
   - Obtain a Gemini API key from [Google AI Studio](https://makersuite.google.com/app/apikey)
   - Open the app and navigate to AI Configuration
   - Enter your API key and configure model settings

3. **Build and Install**
   ```bash
   ./gradlew assembleDebug
   adb install app/build/outputs/apk/debug/app-debug.apk
   ```

### Permissions Required

The app requires several permissions for full functionality:

```xml
<!-- Core screen recording -->
<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.CAPTURE_AUDIO_OUTPUT" />
<uses-permission android:name="android.permission.CAPTURE_VIDEO_OUTPUT" />

<!-- Background services -->
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_MEDIA_PROJECTION" />

<!-- File storage -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />

<!-- Network -->
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

<!-- System overlay -->
<uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
```

## Usage Guide

### Starting a Recording Session

1. **Launch AttentionAI**
2. **Tap "Start Recording"** - This will request screen capture permission
3. **Grant permissions** when prompted by Android
4. **Recording begins automatically** - A notification appears showing active recording
5. **Continue using your device normally** - The app records in the background

### Stopping a Session

- **Tap "Stop Recording"** in the app, or
- **Use the notification action** to stop from anywhere, or
- **The service will auto-stop** when the app is closed

### Analyzing Your Sessions

1. **Wait for upload** - Videos are automatically uploaded to Gemini after recording
2. **Ask questions** like:
   - "What apps did I use the most?"
   - "How productive was this session?"
   - "What were the main distractions?"
   - "Summarize my activity patterns"
3. **View insights** and recommendations generated by AI
4. **Export summaries** for external use

### AI Configuration

Navigate to **Settings > AI Configuration** to customize:

- **API Key** - Your Gemini API key
- **Model Selection** - Choose between Gemini models
- **Temperature** - Creativity level (0.0-1.0)
- **Max Tokens** - Response length limit
- **Custom Instructions** - Personalized analysis focus

## API Integration

### Gemini REST API

The app uses direct REST API calls for video analysis:

```kotlin
// File upload with resumable protocol
val fileUri = geminiRestService.uploadFile(videoFile, apiKey)

// Multi-modal analysis
val analysis = geminiRestService.analyzeFile(
    fileUri = fileUri,
    question = "Analyze this productivity session",
    apiKey = apiKey
)
```

### Supported Analysis Types

- **General Q&A** - Ask any question about recorded content
- **Productivity Analysis** - Focused insights on work patterns
- **App Usage Analysis** - Detailed breakdown of application usage
- **Time Management** - Analysis of time allocation and efficiency
- **Distraction Analysis** - Identification of productivity blockers
- **Summary Generation** - Comprehensive session overviews

## Data Models

### Core Entities

```kotlin
// Recording sessions
data class ActivitySession(
    val id: Long,
    val startTime: Long,
    val endTime: Long?,
    val isActive: Boolean,
    val videoPath: String?,
    val geminiFileUri: String?,
    val productivityScore: Float?
)

// User interactions
data class ActivityEvent(
    val id: Long,
    val sessionId: Long,
    val timestamp: Long,
    val eventType: String,
    val appPackage: String?,
    val appName: String?
)

// AI-generated insights
data class AIInsight(
    val id: Long,
    val sessionId: Long,
    val insightType: String,
    val title: String,
    val description: String,
    val confidence: Float
)
```

## File Management

### Storage Locations

- **Video files**: `External Storage/Movies/AttentionAI/`
- **Database**: Internal app storage
- **Uploaded files**: Tracked via `UploadedFile` entities

### File Lifecycle

1. **Recording** → Local MP4 file created
2. **Upload** → File sent to Gemini via resumable upload
3. **Analysis** → Gemini processes video content
4. **Storage** → File URI stored in database
5. **Cleanup** → Old files can be automatically removed

## Performance Optimizations

### Video Recording
- **Reduced resolution** (360x640) for smaller file sizes
- **Lower frame rate** (15 FPS) for extended battery life
- **HEVC encoding** when available for better compression
- **Optimized bitrates** for quality vs. size balance

### Network
- **Resumable uploads** for reliable large file transfers
- **Retry logic** for failed API calls
- **Connection timeouts** tuned for mobile networks
- **Background processing** to avoid UI blocking

### Database
- **Efficient indexing** on frequently queried columns
- **Batch operations** for multiple inserts
- **Migration handling** for schema updates
- **Background cleanup** of old records

## Troubleshooting

### Common Issues

**Screen recording fails to start**
- Ensure all permissions are granted
- Restart the app and try again
- Check device compatibility (Android 7.0+)

**Audio not captured**
- System audio requires special permissions
- Some devices may not support system audio capture
- Microphone audio works as fallback

**AI analysis errors**
- Verify Gemini API key is correct and active
- Check internet connection
- Ensure uploaded file is fully processed (may take time)

**Large file upload failures**
- Check available storage space
- Ensure stable internet connection
- Resumable upload will retry automatically

### Debug Logs

Enable debug logging by checking logcat for tags:
- `ScreenRecordingService` - Recording issues
- `GeminiRestService` - API communication
- `MainActivity` - UI and permission issues

## Privacy & Security

### Data Handling
- **Local processing** - Videos stored locally first
- **User consent** - Explicit permission for screen capture
- **Secure upload** - HTTPS communication with Gemini
- **API key protection** - Stored securely in SharedPreferences

### Content Privacy
- **No permanent storage** on external servers beyond Gemini
- **User control** - Users can delete sessions and files
- **Selective analysis** - Only uploaded content is analyzed
- **Transparency** - Clear indication when recording is active

## Contributing

We welcome contributions! Please see our [Contributing Guide](CONTRIBUTING.md) for details.

### Development Setup

1. **Fork the repository**
2. **Create a feature branch**
3. **Set up development environment** with Android Studio
4. **Configure test API keys** for development
5. **Run tests** before submitting PRs

### Code Style

- **Kotlin coding conventions**
- **MVVM architecture patterns**
- **Comprehensive error handling**
- **Documentation for public APIs**

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgments

- **Google Gemini AI** for advanced video analysis capabilities
- **Android MediaProjection API** for screen recording functionality
- **Jetpack Compose** for modern UI development
- **Room Database** for local data persistence

## Support

For support, please:
1. **Check troubleshooting section** above
2. **Search existing issues** on GitHub
3. **Create a new issue** with detailed information
4. **Include logs** and device information

---

**Built with ❤️ for productivity enthusiasts**